<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profile page</title>
</head>
<body>
    <div class="row m-3 m-sm-5">
        <div class="col-sm-12 col-md-9 mx-auto">
            <div class="card rounded-0">
                <div class="row">
                    <div class="col-sm-12">
                        <h4 class="text-center my-3">Profile</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
    
                        <h6 id="editProfile" class="text-center my-3">Edit</h6>
                    </div>
                </div>
    
            </div>
            <div class="card p-3 rounded-0 border-top-0">
                <form>
                    <fieldset id="userInfo" disabled>
                        <div class="form-row">
                            <div class="form-group col-12 col-sm-6">
                                <label for="firstName">First Name</label>
                                <input type="text" class="form-control" id="firstName" value="{{firstName}}">
                            </div>
                            <div class="form-group col-12 col-sm-6">
                                <label for="lastName">Last Name</label>
                                <input type="text" class="form-control" id="last_name" value="{{lastName}}">
                            </div>
    
                            <div class="form-group col-12 col-sm-12">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" id="email" value="{{email}}">
                            </div>
                            <div class="form-group col-12 col-sm-6">
                                <label for="password1">Password</label>
                                <input type="password" class="form-control" id="password1" value="Password">
                            </div>
                            <div class="form-group col-12 col-sm-6">
                                <label for="password1">Re-Enter Password</label>
                                <input type="password" class="form-control" id="password2" value="Password">
                            </div>
    
                            <div class="form-group col-12 col-sm-12">
                                <label for="address">Address</label>
                                <input type="text" class="form-control" id="address" value="{{address1}}">
                            </div>
                            <div class="form-group col-12 col-sm-12">
                                <label for="address2">Address 2</label>
                                <input type="text" class="form-control" id="{{address2}}" value="{{address2}}">
                            </div>
    
                            <div class="form-group col-12 col-sm-6">
                                <label for="city">City</label>
                                <input type="text" class="form-control" id="city" value="{{city}}">
                            </div>
                            <div class="form-group col-12 col-sm-4">
                                <label for="state">State</label>
                                <select id="state" class="form-control">
                                    <option selected>Choose...</option>
                                    <option>Alabama</option>
                                </select>
                            </div>
                            <div class="form-group col-12 col-sm-2">
                                <label for="zip">Zip</label>
                                <input type="text" class="form-control" id="zip" value="{{zip}}">
                            </div>
    
                        </div>
                        <div class="form-row">
                            <button id="saveChanges" type="submit" style="display: none;"
                                class="btn btn-primary btn-block my-3 mx-auto">Save Changes</button>
                        </div>
    
                    </fieldset>
    
                </form>
            </div>
        </div>
    </div>
    <div class="row m-3 m-sm-5">
        <div class="col-sm-12 col-md-9 mx-auto">
            <div class="card rounded-0">
                <h4 class="mx-auto my-3">Senators</h4>
            </div>
            <div class="card rounded-0">
                <div class="row">
                    <div class="col-12">
                        <div id="senator1" class="card">
    
                        </div>
                    </div>
    
                </div>
                <div class="row">
                    <div class="col-12">
                        <div id="senator2" class="card">
    
                        </div>
                    </div>
    
                </div>
            </div>
        </div>
    </div>
    <div class="row m-3 m-sm-5">
        <div class="col-sm-12 col-md-9 mx-auto">
            <div class="card rounded-0">
                <h4 class="mx-auto my-3">House Representative</h4>
            </div>
            <div class="card rounded-0">
                <div class="row">
                    <div class="col-12">
                        <div id="usRepresentative" class="card">
    
                        </div>
                    </div>
    
                </div>
            </div>
        </div>
    </div>
    <script>
        var userId = document.cookie.split(';')[0].split('=')[1];
        console.log(userId);
    
        $.get(`/api/users/${userId}`, function (data) {
            console.log(data);
            var baseURL = `https://www.googleapis.com/civicinfo/v2/representatives?key=AIzaSyAyd0njJHxlMvLQPBtkW1cm9BoOsjM2XYg`;
            var formattedAddress = `&address=${data.address1} ${data.address2} ${data.city} ${data.state} ${data.zip}`;
            var roles = `&roles=legislatorUpperBody&roles=legislatorLowerBody`
            var url = baseURL + formattedAddress + roles;
            $.get(url, function (data) {
                console.log(data.officials);
    
                $("#senator1").append(data.officials[0].name);
                $("#senator2").append(data.officials[1].name);
                $("#usRepresentative").append(data.officials[2].name);
    
            });
        });
    
        $("#saveChanges").click(function (e) {
            e.preventDefault();
            $.post(`/api/users/${userId}`, {
                id: userId,
                firstName: $("#firstName").val(),
                lastName: $("#lastName").val(),
                address1: $("#address1").val(),
                address2: $("#address2").val(),
                city: $("#city").val(),
                state: $("#state").val(),
                zip: $("#zip").val(),
                email: $("#email").val(),
                password1: $("#password1").val(),
                password2: $("#password2").val(),
            });
        });
    
    
        $("#editProfile").click(function (e) {
            var disabled = $("#userInfo").attr("disabled");
            if (disabled !== undefined) {
                $("#userInfo").removeAttr("disabled");
                $("#saveChanges").show();
            } else {
    
                $("#userInfo").attr("disabled", true);
                $("#saveChanges").hide();
            }
            console.log(disabled);
    
        });
    </script>
</body>
</html>